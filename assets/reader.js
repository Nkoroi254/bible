!function(){function a(a){function b(a,b,c,d){var e=a.querySelectorAll(c);Array.prototype.forEach.call(e,function(a){(!d||s(a,d,!1))&&b.push(a)})}var c=[];return a=a||document,b(a,c,".chapternum"),b(a,c,"sup.versenum"),0==c.length&&b(a,c,"sup",z),c}function b(b){var c,d,e,f,g,h=NaN;for(f=a(),d=f.length,c=0;d>c;++c){if(g=i(f[c]),g>=b){e=isNaN(h)||Math.abs(h-b)>3*(g-b)?f[c]:f[c-1];break}h=g}return e&&B.setVerse(e.textContent.split("-")[0].trim()),e}function c(b){function c(a){var b=g.querySelectorAll(a);Array.prototype.forEach.call(b,function(a){a.parentNode.removeChild(a)})}var d,e,f,g,h,i,j,k,l,m,n="",o="",p=NaN;for(g=document.createElement("div"),h=document.querySelectorAll(b),e=h.length,d=0;e>d;++d)n+=" "+h.item(d).innerHTML;for(g.innerHTML=n,i=a(g),e=i.length,d=0;e>d;++d)if(k=s(i[d],"chapternum")?"1":i[d].textContent.trim().split("-"),l=parseInt(k[0].trim()),m=NaN,!isNaN(l))for(i[d].parentNode.removeChild(i[d]),k.length>1&&(m=parseInt(k[1].trim())),(!m||isNaN(m))&&(m=l),j=l;m>=j;++j)isNaN(p)?o+=j:j==p||(j-p==1?o.endsWith("-")||(o+="-"):(o.endsWith("-")&&(o+=p),o+=",",o+=j)),p=j;return o.endsWith("-")&&!isNaN(p)&&(o+=p),c(".notelink"),c(".footnote"),c(".crossreference"),f=g.textContent.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"").trim(),{verse:o,text:f}}function d(){var a,b=c(".selected");b.text?(a=document.querySelectorAll(".highlight.selected").length,B.setCopyText(""+a+"\n"+b.verse+"\n"+b.text)):B.setCopyText("")}function e(a){var b,c=a.className;b=!s(a,"selected"),c.match(/\S+/g).forEach(function(a){var c,d,e;if(z&&-1!=a.indexOf(z))for(e=document.getElementsByClassName(a),c=e.length-1;c>-1;--c)d=e.item(c),"SUP"!=d.nodeName&&(b?r(d,"selected"):t(d,"selected"))}),d()}function f(){var a,b,c,d,e,f,g="";if(c=window.search,!c)return!1;for(d=document.body.innerHTML,e=d.toLowerCase(),f=c.toLowerCase();d.length>0&&(b=c,a=e.indexOf(f),!(0>a));)d.lastIndexOf(">",a)>=d.lastIndexOf("<",a)&&(b='<span class="selected">'+c+"</span>"),g+=d.substring(0,a)+b,d=d.substr(a+c.length),e=e.substr(a+c.length);return g+=d,document.body.innerHTML=g,!0}function g(a){return null!=a&&a===a.window}function h(a){return g(a)?a:9===a.nodeType&&a.defaultView}function i(a){var b,c,d,e;return d=a.getBoundingClientRect(),d.width||d.height?(e=a.ownerDocument,c=h(e),b=e.documentElement,Math.round(d.top+c.pageYOffset-b.clientTop)):Math.round(d.top)}function j(){var a,b,c,d,e='<span class="icon-footnote"></span>',g='<span class="icon-crossreference"></span>';u(),f(),a=window.highlighted,b=window.selected,c=window.notes,a&&v(a),b&&w(b),"[object Array]"==Object.prototype.toString.call(c)&&c.forEach(function(a){addnote(a)}),o(),d=document.querySelector("#pb-demo"),d&&(d.style.display="block"),m('a[id*="!f."]',e),m('a[id*="!x."]',g),m("sup.footnote",e),m("sup.crossreference",g),k(100)}function k(a){setTimeout(function(){try{console.log("loaded: "+B.onLoaded()),l()}catch(a){console.log("error calling onLoaded()"),console.log(a),k(500)}},a)}function l(){var a,b,c,d;d=window.verse,!d||parseInt(d)<=1||(c=p(d),c.length>0&&(b=c.item(0),a=i(b)-5,B.setTop(a)))}function m(a,b){var c=document.querySelectorAll(a);Array.prototype.forEach.call(c,function(a){var c=a.getAttribute("value")||a.getAttribute("data-link");c?b?a.innerHTML=c.replace(/^.*?(<a.*?>).*?(<\/a>).*$/g,"$1"+b+"$2"):a.innerHTML=c:a.innerHTML=b})}function n(a){var b,c,d,e;if(b=window.search){for(a=void 0==a?"highlight":a.trim(),e=document.getElementsByClassName(a),c=e.length-1;c>-1;--c)d=e.item(c),d.className.trim()==a&&1==d.childNodes.length&&3==d.firstChild.nodeType?d.parentNode.replaceChild(d.firstChild,d):t(d,a);window.search="",document.normalize()}}function o(){document.querySelector("#content").addEventListener("click",function(a){for(var b,c,d=a.target;d&&"BODY"!=d.nodeName;){if("IMG"==d.nodeName){if(b=d.getAttribute("data-note"))return a.preventDefault(),void B.showNote(b)}else if("A"==d.nodeName&&(s(d,"notelink")||d.parentNode&&"SUP"==d.parentNode.nodeName)){if(c=d.hash.replace("#",""))return a.preventDefault(),void B.showAnnotation(c,"")}else{if("A"==d.nodeName&&s(d,"bibleref"))return a.preventDefault(),void B.showAnnotation("cross",d.outerHTML);if("SPAN"==d.nodeName&&(s(d,"text")||s(d,z,!1))){n("selected"),e(d);break}}d=d.parentNode}})}function p(a){var b,c,d,e,f=z+A+a,g=document.getElementsByClassName(f);if(g.length)return g;if("v"==f[0])for(c=["a","b","c"],b=0;3>b&&(g=document.getElementsByClassName(f+c[b]),!g.length);++b);else{for(e=new RegExp("(?:^|\\s)"+f+"-\\S+"),y||(y=document.querySelectorAll(".text")),b=0;b<y.length&&!(d=y.item(b).className.match(e));++b);b!=y.length&&(g=document.getElementsByClassName(d[0]))}return g.length||2>a?g:p(a-1)}function q(a,b,c){var d,e,f;if(a)for(f=p(a),d=f.length-1;d>-1;--d)e=f.item(d),"SUP"!=e.nodeName&&(b===!1?t(e,c):r(e,c))}function r(a,b){a&&(a.className?s(a,b)||(a.className+=" "+b):a.className=b)}function s(a,b,c){var d;return a&&a.className?(d=c===!1?new RegExp("(?:^|\\s)"+b):new RegExp("(?:^|\\s)"+b+"(?!\\S)"),null!=a.className.match(d)):!1}function t(a,b){var c;a&&a.className&&(c=new RegExp("(?:^|\\s)"+b+"(?!\\S)"),a.className.match(c)&&(a.className=a.className.replace(c,"").trim()))}function u(){if(void 0==z||void 0==A){try{A="-",z=document.querySelector(".text").className.replace(/\s*text\s*/g,"").split(A).splice(0,2).join(A)}catch(a){}try{z&&-1!=z.indexOf(A)||(A="_",z=document.querySelector("sup").className.split(A).splice(0,2).join(A),z&&-1!=z.indexOf(A)||(z="",A=""))}catch(a){}}}function v(a,b,c){u(),z&&(void 0===c&&(c="highlight"),a.split(",").forEach(function(a){var d,e=a.split("-"),f=parseInt(e[0]);if(2==e.length)for(d=parseInt(e[1]);d>=f;++f)q(f,b,c);else q(f,b,c)}))}function w(a,b){v(a,b,"selected")}function x(a,b){var c,d,e,f=p(a);if(f.length)for(c=0;c<f.length;++c)if(e=f.item(c),1==e.childNodes.length&&(e=e.querySelector("sup.versenum")||e.querySelector(".chapternum")||e.querySelector("sup"),e&&(e=e.parentNode)),e&&e.firstChild&&e.firstChild.nextSibling)return void(b===!1&&"IMG"==e.firstChild.nextSibling.nodeName?e.removeChild(e.firstChild.nextSibling):b!==!1&&"IMG"!=e.firstChild.nextSibling.nodeName&&(d=document.createElement("img"),d.setAttribute("class","note"),d.setAttribute("data-note",a),d.setAttribute("src","note.png"),e.insertBefore(d,e.firstChild.nextSibling)))}"undefined"==typeof window.android&&(window.android={setVerse:function(a){console.log("android.setVerse: "+a)},setCopyText:function(a){console.log("android.setCopyText: "+a)},showAnnotation:function(a,b){console.log("android.showAnnotation: "+a+", "+b)},showNote:function(a){console.log("android.showNote: "+a)},setTop:function(a){console.log("android.setTop: "+a)},onLoaded:function(){console.log("android.onLoaded")}});var y,z,A,B=window.android;String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{writable:!1,enumerable:!1,configurable:!1,value:function(a){return-1!==this.indexOf(a,this.length-a.length)}}),window.addEventListener("load",j),window.getFirstVisibleVerse=b,window.highlight=v,window.select=w,window.addNote=x}();