!function(){function a(a){function b(a,b,c,d){var e=a.querySelectorAll(c);Array.prototype.forEach.call(e,function(a){(!d||n(a,d,!1))&&b.push(a)})}var c=[];return a=a||document,b(a,c,".chapternum"),b(a,c,"sup.versenum"),0==c.length&&b(a,c,"sup",u),c}function b(){var b,c,d=NaN;c=a();for(var e=0;e<c.length;e++){var f=Math.round(c[e].getBoundingClientRect().top);if(f>=0){b=isNaN(d)||Math.abs(d)>3*f?c[e]:c[e-1];break}d=f}return b&&android.setVerse(b.textContent.split("-")[0].trim()),b}function c(b){function c(a){var b=d.querySelectorAll(a);Array.prototype.forEach.call(b,function(a){a.parentNode.removeChild(a)})}var d,e,f,g="",h="",i="",j=NaN;d=document.createElement("div"),e=document.querySelectorAll(b);for(var k=0;k<e.length;k++)g+=" "+e.item(k).innerHTML;d.innerHTML=g,f=a(d);for(var k=0;k<f.length;k++){var l,m=NaN,o=NaN;if(l=n(f[k],"chapternum")?"1":f[k].textContent.trim().split("-"),m=parseInt(l[0].trim()),!isNaN(m)){f[k].parentNode.removeChild(f[k]),l.length>1&&(o=parseInt(l[1].trim())),(!o||isNaN(o))&&(o=m);for(var p=m;o>=p;++p)isNaN(j)?i+=p:p==j||(p-j==1?i.endsWith("-")||(i+="-"):(i.endsWith("-")&&(i+=j),i+=",",i+=p)),j=p}}return i.endsWith("-")&&!isNaN(j)&&(i+=j),c(".notelink"),c(".footnote"),c(".crossreference"),h=d.textContent.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"").trim(),{verse:i,text:h}}function d(){var a=c(".selected");if(a.text){var b=document.querySelectorAll(".highlight.selected").length;android.setCopyText(""+b+"\n"+a.verse+"\n"+a.text)}else android.setCopyText("")}function e(a){var b,c=a.className;b=n(a,"selected")?!1:!0,c.match(/\S+/g).forEach(function(a){if(u&&-1!=a.indexOf(u))for(var c=document.getElementsByClassName(a),d=c.length-1;d>-1;--d){var e=c.item(d);"SUP"!=e.nodeName&&(b?m(e,"selected"):o(e,"selected"))}}),d()}function f(a){var b,c,d,e="";if(!a)return!1;for(b=document.body.innerHTML,c=b.toLowerCase(),d=a.toLowerCase();b.length>0;){var f=a,g=c.indexOf(d);if(0>g)break;b.lastIndexOf(">",g)>=b.lastIndexOf("<",g)&&(f='<span class="selected">'+a+"</span>"),e+=b.substring(0,g)+f,b=b.substr(g+a.length),c=c.substr(g+a.length)}return e+=b,document.body.innerHTML=e,!0}function g(){var a,b,c,d='<span class="icon-footnote"></span>',e='<span class="icon-crossreference"></span>';if(p(),f(search),highlighted&&q(highlighted),selected&&r(selected),"[object Array]"==Object.prototype.toString.call(notes)&&notes.forEach(function(a){addnote(a)}),j(),a=document.querySelector("#pb-demo"),a&&(a.style.display="block"),h('a[id*="!f."]',d),h('a[id*="!x."]',e),h("sup.footnote",d),h("sup.crossreference",e),verse_start>1){var g=k(verse_start);g.length>0&&(c=g.item(0),b=c.getAttribute("id"),b?window.location.hash=c.getAttribute("id"):(c.setAttribute("id","pb-start"),window.setTimeout(function(){window.location.hash="pb-start"},100)))}}function h(a,b){var c=document.querySelectorAll(a);Array.prototype.forEach.call(c,function(a){var c=a.getAttribute("value")||a.getAttribute("data-link");c?b?a.innerHTML=c.replace(/^.*?(<a.*?>).*?(<\/a>).*$/g,"$1"+b+"$2"):a.innerHTML=c:a.innerHTML=b})}function i(a){var b;a=void 0==a?"highlight":a.trim(),b=document.getElementsByClassName(a);for(var c=b.length-1;c>-1;--c){var d=b.item(c);d.className.trim()==a&&1==d.childNodes.length&&3==d.firstChild.nodeType?d.parentNode.replaceChild(d.firstChild,d):o(d,a)}search="",document.normalize()}function j(){document.querySelector("#content").addEventListener("click",function(a){for(var b=a.target;b&&"BODY"!=b.nodeName;){if("IMG"==b.nodeName){var c=b.getAttribute("data-note");if(c)return a.preventDefault(),void android.showNote(c)}else if("A"==b.nodeName&&(n(b,"notelink")||b.parentNode&&"SUP"==b.parentNode.nodeName)){var d=b.hash.replace("#","");if(d)return a.preventDefault(),void android.showAnnotation(d)}else if("SPAN"==b.nodeName&&(n(b,"text")||n(b,u,!1))){search&&i("selected"),e(b);break}b=b.parentNode}})}function k(a){var b=u+v+a,c=document.getElementsByClassName(b);if(c.length)return c;if("v"==b[0]){var d=["a","b","c"];for(var e in d)if(c=document.getElementsByClassName(b+d[e]),c.length)break}else{var f,g,h=new RegExp("(?:^|\\s)"+b+"-\\S+");for(t||(t=document.querySelectorAll(".text")),f=0;f<t.length&&!(g=t.item(f).className.match(h));++f);f!=t.length&&(c=document.getElementsByClassName(g[0]))}return c.length||2>a?c:k(a-1)}function l(a,b,c){var d;if(a){d=k(a);for(var e=d.length-1;e>-1;--e){var f=d.item(e);"SUP"!=f.nodeName&&(b===!1?o(f,c):m(f,c))}}}function m(a,b){a&&(a.className?n(a,b)||(a.className+=" "+b):a.className=b)}function n(a,b,c){var d;return a&&a.className?(d=c===!1?new RegExp("(?:^|\\s)"+b):new RegExp("(?:^|\\s)"+b+"(?!\\S)"),null!=a.className.match(d)):!1}function o(a,b){if(a&&a.className){var c=new RegExp("(?:^|\\s)"+b+"(?!\\S)");a.className.match(c)&&(a.className=a.className.replace(c,"").trim())}else;}function p(){if(void 0==u||void 0==v){try{v="-",u=document.querySelector(".text").className.replace(/\s*text\s*/g,"").split(v).splice(0,2).join(v)}catch(a){}try{u&&-1!=u.indexOf(v)||(v="_",u=document.querySelector("sup").className.split(v).splice(0,2).join(v),u&&-1!=u.indexOf(v)||(u="",v=""))}catch(a){}}}function q(a,b,d){p(),u&&(void 0===d&&(d="highlight"),a.split(",").forEach(function(a){var c=a.split("-"),e=parseInt(c[0]);if(2==c.length)for(var f=parseInt(c[1]);f>=e;++e)l(e,b,d);else l(e,b,d)}),"highlight"==d&&android.setHighlighted(c(".highlight").verse))}function r(a,b){q(a,b,"selected")}function s(a,b){var c,d=k(a);if(d.length)for(var e=0;e<d.length;++e)if(c=d.item(e),1==c.childNodes.length&&(c=c.querySelector("sup.versenum")||c.querySelector(".chapternum")||c.querySelector("sup"),c&&(c=c.parentNode)),c.firstChild&&c.firstChild.nextSibling){if(b===!1&&"IMG"==c.firstChild.nextSibling.nodeName)c.removeChild(c.firstChild.nextSibling);else if(b!==!1&&"IMG"!=c.firstChild.nextSibling.nodeName){var f=document.createElement("img");f.setAttribute("class","note"),f.setAttribute("data-note",a),f.setAttribute("src","note.png"),c.insertBefore(f,c.firstChild.nextSibling)}return}}"undefined"==typeof android&&(android={setVerse:function(a){console.log("android.setVerse: "+a)},setCopyText:function(a){console.log("android.setCopyText: "+a)},setHighlighted:function(a){console.log("android.setHighlighted: "+a)},showAnnotation:function(a){console.log("android.showAnnotation: "+a)},showNote:function(a){console.log("android.showNote: "+a)}});var t,u,v;String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{writable:!1,enumerable:!1,configurable:!1,value:function(a){return-1!==this.indexOf(a,this.length-a.length)}}),window.addEventListener("load",g),window.getFirstVisibleVerse=b,window.highlight=q,window.select=r,window.addnote=s}();